package com.bank.demo.service;

import org.springframework.stereotype.Service;

import com.bank.demo.entity.Account;
import com.bank.demo.entity.Transaction;
import com.bank.demo.repository.AccountsRepository;
import com.bank.demo.repository.TransactionRepository;
import com.bank.demo.service.exception.InsufficientBalanceException;
import com.bank.demo.service.exception.ResourceNotFoundException;

import lombok.AllArgsConstructor;

@Service
@AllArgsConstructor
public class TransferService {
	private final TransactionRepository transRepo;
	private final AccountsRepository accountRepo;

	public Transaction transfer(Transaction transaction) {
		Account src = accountRepo.findById(transaction.getSender()).orElseThrow(() -> new ResourceNotFoundException());
		Account dist = accountRepo.findById(transaction.getReceiver()).orElseThrow(() -> new ResourceNotFoundException());
		if (src.getBalance() < transaction.getAmount()) {
			throw new InsufficientBalanceException("Current balance: " + src.getBalance() + " is insufficient.");
		}

		src.setBalance(src.getBalance() - transaction.getAmount());
		dist.setBalance(dist.getBalance() + transaction.getAmount());
		accService.updateStudent(src);
		accService.updateStudent(dist);
		return transRepo.save(transaction);
	}

}
